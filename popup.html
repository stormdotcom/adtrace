<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AdTrace</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Syne:wght@400;600;700;800&display=swap');

  :root {
    --navy: #080d1a;
    --navy-2: #0d1528;
    --navy-3: #111d35;
    --navy-4: #1a2847;
    --cyan: #00d4ff;
    --cyan-dim: #00d4ff33;
    --cyan-mid: #00d4ff88;
    --amber: #f59e0b;
    --amber-dim: #f59e0b22;
    --red: #ff4757;
    --red-dim: #ff475722;
    --green: #2dce7d;
    --green-dim: #2dce7d22;
    --purple: #8b5cf6;
    --text: #e2e8f0;
    --text-muted: #64748b;
    --text-dim: #94a3b8;
    --border: #1e2d4a;
    --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
    --font-ui: 'Syne', system-ui, sans-serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    width: 420px;
    min-height: 560px;
    background: var(--navy);
    color: var(--text);
    font-family: var(--font-ui);
    font-size: 13px;
    overflow-x: hidden;
  }

  /* === HEADER === */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px 12px;
    background: var(--navy-2);
    border-bottom: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }
  .header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--cyan), var(--purple), var(--amber));
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .logo-icon {
    width: 28px;
    height: 28px;
    position: relative;
  }
  .logo-icon svg {
    width: 100%;
    height: 100%;
  }
  .logo-text {
    font-family: var(--font-ui);
    font-size: 18px;
    font-weight: 800;
    letter-spacing: -0.02em;
    color: var(--text);
  }
  .logo-text span {
    color: var(--cyan);
  }

  .header-controls {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Master toggle */
  .toggle-wrap {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .toggle-label {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: .08em;
  }
  .toggle {
    position: relative;
    width: 36px;
    height: 20px;
  }
  .toggle input { display: none; }
  .toggle-track {
    position: absolute;
    inset: 0;
    background: var(--navy-4);
    border: 1px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    transition: background .2s, border-color .2s;
  }
  .toggle-thumb {
    position: absolute;
    top: 3px; left: 3px;
    width: 12px; height: 12px;
    background: var(--text-muted);
    border-radius: 50%;
    transition: transform .2s, background .2s;
    pointer-events: none;
  }
  .toggle input:checked + .toggle-track {
    background: var(--cyan-dim);
    border-color: var(--cyan);
  }
  .toggle input:checked + .toggle-track + .toggle-thumb {
    transform: translateX(16px);
    background: var(--cyan);
  }

  /* Dev mode button */
  .dev-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text-muted);
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: pointer;
    transition: all .15s;
    text-transform: uppercase;
    letter-spacing: .06em;
  }
  .dev-btn.active {
    background: var(--amber-dim);
    border-color: var(--amber);
    color: var(--amber);
  }
  .dev-btn:hover { border-color: var(--text-muted); color: var(--text); }
  .dev-btn.active:hover { border-color: var(--amber); color: var(--amber); }

  /* === STATS BAR === */
  .stats-bar {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    background: var(--navy-2);
    border-bottom: 1px solid var(--border);
  }
  .stat-cell {
    padding: 10px 12px;
    text-align: center;
    border-right: 1px solid var(--border);
    position: relative;
  }
  .stat-cell:last-child { border-right: none; }
  .stat-num {
    font-family: var(--font-mono);
    font-size: 20px;
    font-weight: 700;
    line-height: 1;
    color: var(--cyan);
    display: block;
  }
  .stat-num.amber { color: var(--amber); }
  .stat-num.red { color: var(--red); }
  .stat-num.purple { color: var(--purple); }
  .stat-label {
    font-size: 9px;
    font-family: var(--font-mono);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: .07em;
    margin-top: 2px;
    display: block;
  }

  /* === TABS === */
  .tabs {
    display: flex;
    background: var(--navy-2);
    border-bottom: 1px solid var(--border);
  }
  .tab {
    flex: 1;
    padding: 8px;
    text-align: center;
    font-family: var(--font-mono);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: .07em;
    color: var(--text-muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all .15s;
    background: none;
    border-top: none;
    border-left: none;
    border-right: none;
  }
  .tab:hover { color: var(--text-dim); }
  .tab.active {
    color: var(--cyan);
    border-bottom-color: var(--cyan);
  }

  /* === PANELS === */
  .panel { display: none; }
  .panel.active { display: block; }

  /* Log panel */
  .log-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
    background: var(--navy-2);
  }
  .log-filter {
    display: flex;
    gap: 4px;
  }
  .filter-chip {
    padding: 2px 8px;
    border-radius: 12px;
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all .12s;
    background: var(--navy-3);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: .05em;
  }
  .filter-chip.active { 
    background: var(--cyan-dim); 
    border-color: var(--cyan); 
    color: var(--cyan); 
  }
  .filter-chip[data-cat="ad"].active { background: var(--red-dim); border-color: var(--red); color: var(--red); }
  .filter-chip[data-cat="tracker"].active { background: var(--amber-dim); border-color: var(--amber); color: var(--amber); }
  .filter-chip[data-cat="social"].active { background: #8b5cf622; border-color: var(--purple); color: var(--purple); }

  .clear-btn {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: .05em;
    padding: 2px 6px;
    transition: color .12s;
  }
  .clear-btn:hover { color: var(--red); }

  .log-list {
    max-height: 300px;
    overflow-y: auto;
  }
  .log-list::-webkit-scrollbar { width: 4px; }
  .log-list::-webkit-scrollbar-track { background: var(--navy); }
  .log-list::-webkit-scrollbar-thumb { background: var(--navy-4); border-radius: 2px; }

  .log-entry {
    display: flex;
    align-items: flex-start;
    padding: 7px 12px;
    border-bottom: 1px solid #0d1528;
    gap: 8px;
    cursor: default;
    transition: background .1s;
    animation: slideIn .15s ease-out;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-4px); }
    to { opacity: 1; transform: translateX(0); }
  }
  .log-entry:hover { background: var(--navy-2); }

  .entry-cat {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    margin-top: 5px;
    flex-shrink: 0;
  }
  .entry-cat.ad { background: var(--red); box-shadow: 0 0 4px var(--red); }
  .entry-cat.tracker { background: var(--amber); box-shadow: 0 0 4px var(--amber); }
  .entry-cat.social { background: var(--purple); box-shadow: 0 0 4px var(--purple); }
  .entry-cat.other { background: var(--text-muted); }

  .entry-info { flex: 1; min-width: 0; }
  .entry-url {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-dim);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
  }
  .entry-meta {
    display: flex;
    gap: 6px;
    margin-top: 2px;
  }
  .meta-tag {
    font-family: var(--font-mono);
    font-size: 9px;
    padding: 0 4px;
    border-radius: 2px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: .04em;
  }
  .meta-tag.type { background: var(--navy-3); color: var(--text-muted); }
  .meta-tag.rule { background: var(--cyan-dim); color: var(--cyan); }
  .meta-tag.time { background: transparent; color: var(--text-muted); }

  .entry-actions {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
  }
  .entry-action-btn {
    width: 20px; height: 20px;
    border: 1px solid var(--border);
    border-radius: 3px;
    background: var(--navy-3);
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all .12s;
    font-size: 9px;
  }
  .entry-action-btn:hover { border-color: var(--cyan); color: var(--cyan); background: var(--cyan-dim); }
  .entry-action-btn.allow:hover { border-color: var(--green); color: var(--green); background: var(--green-dim); }
  .entry-action-btn.block:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }

  /* Empty state */
  .empty-state {
    padding: 40px 20px;
    text-align: center;
    color: var(--text-muted);
  }
  .empty-state .empty-icon { font-size: 28px; margin-bottom: 8px; opacity: .5; }
  .empty-state p { font-family: var(--font-mono); font-size: 11px; line-height: 1.6; }

  /* === DOMAINS PANEL === */
  .domains-panel { padding: 0; }
  .current-domain {
    padding: 10px 12px;
    background: var(--navy-2);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .domain-info { display: flex; align-items: center; gap: 8px; }
  .domain-status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--green);
    box-shadow: 0 0 6px var(--green);
    flex-shrink: 0;
  }
  .domain-status-dot.blocked { background: var(--red); box-shadow: 0 0 6px var(--red); }
  .domain-status-dot.allowed { background: var(--cyan); box-shadow: 0 0 6px var(--cyan); }
  .domain-name {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--text);
    font-weight: 500;
  }
  .domain-sub { font-size: 10px; color: var(--text-muted); margin-top: 1px; font-family: var(--font-mono); }

  .domain-actions { display: flex; gap: 4px; }
  .domain-btn {
    padding: 4px 10px;
    border-radius: 3px;
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--navy-3);
    color: var(--text-muted);
    transition: all .12s;
    text-transform: uppercase;
    letter-spacing: .05em;
  }
  .domain-btn:hover { border-color: var(--text-dim); color: var(--text); }
  .domain-btn.allow-btn:hover { background: var(--green-dim); border-color: var(--green); color: var(--green); }
  .domain-btn.block-btn:hover { background: var(--red-dim); border-color: var(--red); color: var(--red); }
  .domain-btn.active-allow { background: var(--green-dim); border-color: var(--green); color: var(--green); }
  .domain-btn.active-block { background: var(--red-dim); border-color: var(--red); color: var(--red); }

  .overrides-list { padding: 8px 0; }
  .override-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 12px;
    border-bottom: 1px solid var(--border);
  }
  .override-domain { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }
  .override-mode {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: var(--font-mono);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: .05em;
  }
  .override-mode.allow { color: var(--cyan); }
  .override-mode.allow::before { content: ''; display: inline-block; width: 5px; height: 5px; border-radius: 50%; background: var(--cyan); }
  .override-mode.block { color: var(--red); }
  .override-mode.block::before { content: ''; display: inline-block; width: 5px; height: 5px; border-radius: 50%; background: var(--red); }
  .remove-override { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 12px; padding: 2px 4px; transition: color .12s; }
  .remove-override:hover { color: var(--red); }
  .local-label { font-family: var(--font-mono); font-size: 9px; color: var(--green); margin-left: 4px; text-transform: uppercase; background: var(--green-dim); padding: 1px 4px; border-radius: 2px; }

  /* === RULES PANEL === */
  .rules-panel { padding: 12px; }
  .rules-panel h3 {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: .08em;
    margin-bottom: 8px;
  }
  .rule-editor {
    background: var(--navy-2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 8px;
    margin-bottom: 10px;
  }
  .rule-input {
    width: 100%;
    background: var(--navy);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 6px 8px;
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text);
    outline: none;
    resize: vertical;
    min-height: 70px;
    transition: border-color .15s;
    margin-bottom: 8px;
  }
  .rule-input:focus { border-color: var(--cyan); }
  .rule-input::placeholder { color: var(--text-muted); }

  .rule-actions { display: flex; gap: 6px; justify-content: flex-end; }
  .btn-primary {
    padding: 5px 12px;
    background: var(--cyan-dim);
    border: 1px solid var(--cyan);
    border-radius: 3px;
    color: var(--cyan);
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: .06em;
    transition: all .12s;
    font-weight: 700;
  }
  .btn-primary:hover { background: var(--cyan); color: var(--navy); }
  .btn-secondary {
    padding: 5px 12px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 3px;
    color: var(--text-muted);
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: .06em;
    transition: all .12s;
  }
  .btn-secondary:hover { border-color: var(--text-dim); color: var(--text); }

  .rule-hint {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    line-height: 1.6;
    padding: 6px 8px;
    background: var(--navy-3);
    border-radius: 3px;
    margin-top: 6px;
  }
  .rule-hint code { color: var(--cyan); }

  /* === REPORT PANEL === */
  .report-panel { padding: 12px; }
  .report-summary {
    background: var(--navy-2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 10px;
    margin-bottom: 10px;
  }
  .report-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid var(--border);
  }
  .report-row:last-child { border-bottom: none; }
  .report-key { font-family: var(--font-mono); font-size: 10px; color: var(--text-muted); }
  .report-val { font-family: var(--font-mono); font-size: 10px; color: var(--text); font-weight: 700; }

  .report-domains { margin-bottom: 10px; }
  .rdomain-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 5px 8px;
    border-bottom: 1px solid var(--border);
  }
  .rdomain-name { font-family: var(--font-mono); font-size: 10px; color: var(--text-dim); }
  .rdomain-count {
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 10px;
    background: var(--navy-3);
    color: var(--text-muted);
  }
  .rdomain-count.high { background: var(--red-dim); color: var(--red); }
  .rdomain-count.med { background: var(--amber-dim); color: var(--amber); }
  .rdomain-count.low { background: var(--cyan-dim); color: var(--cyan); }

  .export-btn {
    width: 100%;
    padding: 8px;
    background: var(--navy-2);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text-dim);
    font-family: var(--font-mono);
    font-size: 11px;
    cursor: pointer;
    transition: all .15s;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: .07em;
  }
  .export-btn:hover { background: var(--cyan-dim); border-color: var(--cyan); color: var(--cyan); }
  .export-btn + .export-btn { margin-top: 6px; }

  /* Footer */
  .footer {
    padding: 8px 12px;
    background: var(--navy-2);
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .footer-left { font-family: var(--font-mono); font-size: 9px; color: var(--text-muted); }
  .footer-left span { color: var(--cyan); }
  .options-link {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: .06em;
    background: none;
    border: none;
    transition: color .12s;
  }
  .options-link:hover { color: var(--cyan); }

  /* Simulate toggle */
  .sim-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: var(--amber-dim);
    border-bottom: 1px solid var(--amber);
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--amber);
  }
  .sim-bar.hidden { display: none; }
  .sim-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--amber); animation: pulse 1s ease infinite; }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .3; } }
  .sim-close { margin-left: auto; background: none; border: none; color: var(--amber); cursor: pointer; font-size: 13px; }

  /* Scrollbar for panels */
  .panel-scroll { max-height: 360px; overflow-y: auto; }
  .panel-scroll::-webkit-scrollbar { width: 4px; }
  .panel-scroll::-webkit-scrollbar-track { background: var(--navy); }
  .panel-scroll::-webkit-scrollbar-thumb { background: var(--navy-4); border-radius: 2px; }

  /* Animate stats update */
  @keyframes flash { 0% { color: var(--cyan); } 100% { } }
  .stat-updated { animation: flash .3s ease-out; }

  .no-overrides {
    padding: 20px;
    text-align: center;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-muted);
  }

  /* Intent tags in log */
  .meta-tag.intent {
    border-radius: 2px;
    font-weight: 500;
  }
  .meta-tag.intent.ad-network { background: var(--red-dim); color: var(--red); }
  .meta-tag.intent.analytics { background: var(--amber-dim); color: var(--amber); }
  .meta-tag.intent.session-replay { background: #f472b622; color: #f472b6; }
  .meta-tag.intent.fingerprinting { background: #ef444422; color: #ef4444; }
  .meta-tag.intent.crypto-miner { background: #dc262622; color: #dc2626; }
  .meta-tag.intent.payment-sdk { background: var(--green-dim); color: var(--green); }
  .meta-tag.intent.cdn { background: #06b6d422; color: #06b6d4; }
  .meta-tag.intent.social { background: #8b5cf622; color: var(--purple); }
  .meta-tag.intent.unknown { background: var(--navy-3); color: var(--text-muted); }
  .meta-tag.intent.custom { background: var(--cyan-dim); color: var(--cyan); }

  /* FP tag */
  .meta-tag.fp-tag {
    background: #f59e0b22;
    border: 1px solid #f59e0b44;
    color: var(--amber);
    font-weight: 700;
  }

  /* FP warning bar */
  .fp-warning-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background: #f59e0b11;
    border-bottom: 1px solid #f59e0b44;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--amber);
  }
  .fp-warning-bar.hidden { display: none; }
  .fp-warning-bar .fp-dismiss-btn {
    margin-left: auto;
    background: none;
    border: none;
    color: var(--amber);
    cursor: pointer;
    font-size: 12px;
  }

  /* FP entry highlight */
  .log-entry.fp-entry {
    border-left: 2px solid var(--amber);
  }

  /* Entry list source */
  .entry-list {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Inspect button */
  .inspect-btn {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text-muted);
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: pointer;
    transition: all .15s;
    text-transform: uppercase;
    letter-spacing: .06em;
  }
  .inspect-btn:hover { border-color: var(--cyan); color: var(--cyan); }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="logo">
    <div class="logo-icon">
      <svg viewBox="0 0 28 28" fill="none">
        <rect x="2" y="2" width="24" height="24" rx="6" fill="#0d1528"/>
        <rect x="2" y="2" width="24" height="24" rx="6" stroke="#1e2d4a" stroke-width="1"/>
        <path d="M8 14 L13 19 L20 9" stroke="#00d4ff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="8" cy="9" r="1.5" fill="#f59e0b"/>
        <circle cx="14" cy="7" r="1.5" fill="#f59e0b"/>
        <circle cx="20" cy="9" r="1.5" fill="#00d4ff"/>
      </svg>
    </div>
    <span class="logo-text">Ad<span>Trace</span></span>
  </div>
  <div class="header-controls">
    <button class="inspect-btn" id="inspectBtn" title="Click any element to see why it's blocked">INSPECT</button>
    <button class="dev-btn" id="devModeBtn">
      <svg width="10" height="10" viewBox="0 0 10 10" fill="none">
        <path d="M3 2L1 5L3 8M7 2L9 5L7 8" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
      </svg>
      DEV
    </button>
    <div class="toggle-wrap">
      <span class="toggle-label">ON</span>
      <label class="toggle">
        <input type="checkbox" id="masterToggle" checked>
        <div class="toggle-track"></div>
        <div class="toggle-thumb"></div>
      </label>
    </div>
  </div>
</div>

<!-- Simulate bar -->
<div class="sim-bar hidden" id="simBar">
  <div class="sim-dot"></div>
  SIMULATING USER VIEW — Ads visible, no dev overlays
  <button class="sim-close" id="simClose">✕</button>
</div>

<!-- False Positive Warning -->
<div class="fp-warning-bar hidden" id="fpWarningBar">
  <span>Warning: <strong id="fpCount">0</strong> blocked requests may break functionality</span>
  <button class="fp-dismiss-btn" id="fpDismiss">Dismiss</button>
</div>

<!-- Stats -->
<div class="stats-bar" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr;">
  <div class="stat-cell">
    <span class="stat-num" id="statBlocked">0</span>
    <span class="stat-label">Blocked</span>
  </div>
  <div class="stat-cell">
    <span class="stat-num amber" id="statTrackers">0</span>
    <span class="stat-label">Trackers</span>
  </div>
  <div class="stat-cell">
    <span class="stat-num red" id="statAds">0</span>
    <span class="stat-label">Ads</span>
  </div>
  <div class="stat-cell">
    <span class="stat-num purple" id="statSocial">0</span>
    <span class="stat-label">Social</span>
  </div>
  <div class="stat-cell">
    <span class="stat-num" style="color: var(--green);" id="statSavings">0ms</span>
    <span class="stat-label">Saved</span>
  </div>
</div>

<!-- Tabs -->
<div class="tabs">
  <button class="tab active" data-panel="log">Log</button>
  <button class="tab" data-panel="domains">Domains</button>
  <button class="tab" data-panel="rules">Rules</button>
  <button class="tab" data-panel="report">Report</button>
</div>

<!-- LOG PANEL -->
<div class="panel active" id="panel-log">
  <div class="log-header">
    <div class="log-filter">
      <span class="filter-chip active" data-cat="all">All</span>
      <span class="filter-chip" data-cat="ad">Ads</span>
      <span class="filter-chip" data-cat="tracker">Track</span>
      <span class="filter-chip" data-cat="social">Social</span>
      <span class="filter-chip" data-cat="fp" style="color: var(--amber);">FP</span>
    </div>
    <button class="clear-btn" id="clearLog">Clear</button>
  </div>
  <div class="log-list" id="logList">
    <div class="empty-state">
      <div class="empty-icon">⬡</div>
      <p>No blocked requests yet.<br>Navigate to a page to start tracing.</p>
    </div>
  </div>
</div>

<!-- DOMAINS PANEL -->
<div class="panel" id="panel-domains">
  <div class="domains-panel">
    <div class="current-domain" id="currentDomainRow">
      <div class="domain-info">
        <div class="domain-status-dot" id="domainStatusDot"></div>
        <div>
          <div class="domain-name" id="currentDomainName">—</div>
          <div class="domain-sub" id="currentDomainSub">Current page domain</div>
        </div>
      </div>
      <div class="domain-actions">
        <button class="domain-btn allow-btn" id="allowDomainBtn">Allow</button>
        <button class="domain-btn block-btn" id="blockDomainBtn">Block</button>
      </div>
    </div>
    <div class="panel-scroll">
      <div style="padding: 8px 12px 4px; font-family: var(--font-mono); font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: .07em;">
        Domain Overrides
      </div>
      <div id="overridesList">
        <div class="no-overrides">No custom overrides.<br>localhost is auto-whitelisted.</div>
      </div>
    </div>
  </div>
</div>

<!-- RULES PANEL -->
<div class="panel" id="panel-rules">
  <div class="rules-panel">
    <h3>Custom Network Rules</h3>
    <div class="rule-editor">
      <textarea class="rule-input" id="networkRuleInput" placeholder="||example.com^&#10;||ads.example.com/banner$image&#10;/tracking-pixel.gif$image,third-party"></textarea>
      <div class="rule-hint">
        Format: <code>||domain.com^</code> blocks entire domain<br>
        <code>||url.com/path$type</code> — filter by resource type<br>
        Types: <code>script</code>, <code>image</code>, <code>xmlhttprequest</code>, <code>sub_frame</code>
      </div>
      <div class="rule-actions" style="margin-top:8px">
        <button class="btn-secondary" id="previewRuleBtn">Preview</button>
        <button class="btn-primary" id="saveRuleBtn">Apply Rule</button>
      </div>
    </div>

    <h3>Custom Cosmetic Rules</h3>
    <div class="rule-editor">
      <textarea class="rule-input" id="cosmeticRuleInput" placeholder="##.ad-banner&#10;##[id^='sponsor-']&#10;example.com##.promoted-post"></textarea>
      <div class="rule-hint">
        Format: <code>##.selector</code> hides elements globally<br>
        <code>domain.com##.selector</code> hides on specific domain<br>
        Uses standard CSS selectors
      </div>
      <div class="rule-actions" style="margin-top:8px">
        <button class="btn-primary" id="saveCosmeticBtn">Apply Cosmetic</button>
      </div>
    </div>

    <div id="ruleStatus" style="font-family: var(--font-mono); font-size: 10px; color: var(--green); padding: 4px 0; display: none;"></div>
  </div>
</div>

<!-- REPORT PANEL -->
<div class="panel" id="panel-report">
  <div class="report-panel panel-scroll">
    <div class="report-summary" id="reportSummary">
      <div class="report-row">
        <span class="report-key">Page</span>
        <span class="report-val" id="reportPage">—</span>
      </div>
      <div class="report-row">
        <span class="report-key">Total Blocked</span>
        <span class="report-val" id="reportTotal">0</span>
      </div>
      <div class="report-row">
        <span class="report-key">Ad Networks</span>
        <span class="report-val" id="reportAds">0</span>
      </div>
      <div class="report-row">
        <span class="report-key">Trackers</span>
        <span class="report-val" id="reportTrackers">0</span>
      </div>
      <div class="report-row">
        <span class="report-key">Social Pixels</span>
        <span class="report-val" id="reportSocial">0</span>
      </div>
      <div class="report-row">
        <span class="report-key">Est. Time Saved</span>
        <span class="report-val" id="reportSavings" style="color: var(--green);">0ms</span>
      </div>
    </div>

    <div style="font-family: var(--font-mono); font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: .07em; margin-bottom: 6px;">
      Blocked Domains
    </div>
    <div class="report-domains" id="reportDomains">
      <div class="rdomain-item" style="color: var(--text-muted); font-family: var(--font-mono); font-size: 10px;">No data — visit a page first</div>
    </div>

    <button class="export-btn" id="exportJsonBtn">⬇ Export JSON Report</button>
    <button class="export-btn" id="exportCsvBtn">⬇ Export CSV Report</button>

    <div style="margin-top: 8px; font-family: var(--font-mono); font-size: 9px; color: var(--text-muted); text-align: center; padding: 4px;">
      Reports are useful for auditing ad/tracker loads on client sites.
    </div>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <div class="footer-left">AdTrace <span>v1.0</span> · MV3</div>
  <div style="display:flex; gap: 8px;">
    <button class="options-link" id="simulateBtn">Simulate User</button>
    <button class="options-link" id="optionsBtn">Options</button>
  </div>
</div>

<script src="popup.js"></script>
</body>
</html>
