<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AdTrace DevPanel</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Syne:wght@400;600;700;800&display=swap');

    :root {
      --navy: #080d1a;
      --navy-2: #0d1528;
      --navy-3: #111d35;
      --navy-4: #1a2847;
      --cyan: #00d4ff;
      --cyan-dim: #00d4ff22;
      --amber: #f59e0b;
      --red: #ff4757;
      --green: #2dce7d;
      --purple: #a142f4;
      --text: #e2e8f0;
      --text-muted: #64748b;
      --text-dim: #94a3b8;
      --border: #1e2d4a;
      --font-mono: 'JetBrains Mono', monospace;
      --font-ui: 'Syne', system-ui, sans-serif;
      --r: 6px;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100%; overflow:hidden; }

    body {
      background: var(--navy);
      color: var(--text);
      font-family: var(--font-ui);
      font-size: 12px;
      display: flex;
      flex-direction: column;
    }

    /* ─── TOP BAR ─── */
    .topbar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      background: var(--navy-2);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      position: relative;
    }
    .topbar::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, var(--cyan), transparent);
    }

    .logo { font-size: 15px; font-weight: 800; color: var(--text); flex-shrink: 0; letter-spacing: -0.01em; }
    .logo em { color: var(--cyan); font-style: normal; }
    .logo-icon { width: 18px; height: 18px; margin-right: 6px; vertical-align: middle; }
    
    .topbar-sep { width: 1px; height: 20px; background: var(--border); flex-shrink: 0; }

    .stat-pill {
      display: flex; align-items: center; gap: 4px;
      padding: 4px 10px; border-radius: 4px;
      background: var(--navy-3); font-size: 11px; white-space: nowrap; font-weight: 500;
      border: 1px solid var(--border);
      font-family: var(--font-mono);
    }
    .stat-pill .dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
    .stat-pill .num { font-weight: 700; color: var(--cyan); }
    .sp-yellow .num { color: var(--amber); }
    .sp-red .num { color: var(--red); }
    .sp-green .num { color: var(--green); }
    .sp-orange .num { color: var(--amber); }

    .spacer { flex: 1; }

    .topbar-btn {
      padding: 6px 14px; border-radius: 4px; border: 1px solid var(--border);
      background: var(--navy-3); color: var(--text-dim); font-family: var(--font-mono);
      font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; transition: all .12s; white-space: nowrap;
    }
    .topbar-btn:hover { border-color: var(--cyan); color: var(--cyan); background: var(--navy-4); }
    .topbar-btn.active { background: var(--cyan-dim); border-color: var(--cyan); color: var(--cyan); }
    .topbar-btn.danger:hover { background: rgba(255, 71, 87, 0.1); border-color: var(--red); color: var(--red); }
    .topbar-btn svg { width: 14px; height: 14px; vertical-align: -3px; margin-right: 4px; }

    /* ─── VIEW TABS ─── */
    .view-tabs {
      display: flex; background: var(--navy-2);
      border-bottom: 1px solid var(--border); flex-shrink: 0; padding: 0 16px;
    }
    .view-tab {
      padding: 10px 16px; font-size: 11px; font-weight: 600;
      color: var(--text-muted); cursor: pointer; border: none; background: none;
      font-family: var(--font-ui); border-bottom: 2px solid transparent; transition: all .12s;
      text-transform: uppercase; letter-spacing: 0.08em;
    }
    .view-tab:hover { color: var(--text); }
    .view-tab.active { color: var(--cyan); border-bottom-color: var(--cyan); }

    /* ─── FILTER BAR ─── */
    .filterbar {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px; background: var(--navy);
      border-bottom: 1px solid var(--border); flex-shrink: 0;
    }
    .filter-label { font-size: 10px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; flex-shrink: 0; }
    .chip {
      padding: 3px 8px; border-radius: 4px; border: 1px solid var(--border);
      background: var(--navy-2); color: var(--text-muted); font-size: 10px;
      cursor: pointer; font-weight: 500; transition: all .1s; font-family: var(--font-mono);
    }
    .chip:hover { border-color: var(--text-dim); }
    .chip.on { border-color: var(--cyan); color: var(--cyan); background: var(--cyan-dim); }
    
    .search-input {
      flex: 1; background: var(--navy-2); border: 1px solid var(--border);
      border-radius: 4px; padding: 5px 12px; font-family: var(--font-mono);
      font-size: 11px; color: var(--text); outline: none; transition: border-color .15s;
    }
    .search-input:focus { border-color: var(--cyan); background: var(--navy-3); }

    /* ─── MAIN ─── */
    .main { display: flex; flex: 1; overflow: hidden; background: var(--navy); }
    .view-panel { display: none; flex: 1; flex-direction: column; overflow: hidden; }
    .view-panel.active { display: flex; }

    /* ─── TABLE ─── */
    .request-pane { flex: 1; display: flex; flex-direction: column; overflow: hidden; border-right: 1px solid var(--border); }
    .table-head {
      display: grid;
      grid-template-columns: 24px 1fr 70px 70px 100px 70px 80px;
      padding: 8px 16px; background: var(--navy-2);
      border-bottom: 1px solid var(--border);
      font-size: 10px; color: var(--text-muted); font-weight: 700; flex-shrink: 0;
      text-transform: uppercase; letter-spacing: 0.05em;
    }
    .table-body { flex: 1; overflow-y: auto; background: var(--navy); }
    .table-body::-webkit-scrollbar { width: 4px; }
    .table-body::-webkit-scrollbar-thumb { background: var(--border); }

    .row {
      display: grid;
      grid-template-columns: 24px 1fr 70px 70px 100px 70px 80px;
      padding: 6px 16px; border-bottom: 1px solid var(--border);
      cursor: pointer; transition: background .05s;
      align-items: center;
    }
    .row:hover { background: var(--navy-2); }
    .row.selected { background: var(--navy-3); border-left: 2px solid var(--cyan); padding-left: 14px; }
    .row.fp-warning { border-left: 3px solid var(--amber); }
    
    .dot { width: 6px; height: 6px; border-radius: 50%; }
    .dot.ad { background: var(--red); box-shadow: 0 0 6px var(--red); }
    .dot.tracker { background: var(--amber); box-shadow: 0 0 6px var(--amber); }
    .dot.social { background: var(--purple); }
    .dot.other { background: var(--text-muted); }

    .row .url-col { font-family: var(--font-mono); font-size: 11px; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 8px; }
    .row .url-col .domain-part { color: var(--cyan); }
    .row .type-col { font-size: 10px; color: var(--text-dim); font-family: var(--font-mono); }
    .row .rule-col { font-size: 11px; color: var(--cyan); font-family: var(--font-mono); }
    
    /* Intent tags */
    .intent-tag {
      display: inline-block; padding: 2px 6px; border-radius: 3px;
      font-size: 9px; font-weight: 600; white-space: nowrap; font-family: var(--font-mono);
      text-transform: uppercase; border: 1px solid transparent;
    }
    .intent-tag.ad-network { background: rgba(255, 71, 87, 0.1); color: var(--red); border-color: rgba(255, 71, 87, 0.2); }
    .intent-tag.analytics { background: rgba(245, 158, 11, 0.1); color: var(--amber); border-color: rgba(245, 158, 11, 0.2); }
    .intent-tag.session-replay { background: rgba(233, 30, 99, 0.1); color: #e91e63; }
    .intent-tag.payment-sdk { background: rgba(45, 206, 125, 0.1); color: var(--green); }
    .intent-tag.unknown { color: var(--text-muted); }

    /* ─── DETAIL PANE ─── */
    .detail-pane {
      width: 360px; flex-shrink: 0; display: flex;
      flex-direction: column; overflow: hidden; background: var(--navy-2);
      border-left: 1px solid var(--border);
    }
    .detail-header {
      padding: 12px 16px; border-bottom: 1px solid var(--border);
      font-size: 11px; color: var(--text-muted); font-weight: 700; flex-shrink: 0;
      text-transform: uppercase; letter-spacing: 0.05em;
    }
    .detail-body { flex: 1; overflow-y: auto; padding: 16px; }
    .detail-body::-webkit-scrollbar { width: 4px; }
    .detail-body::-webkit-scrollbar-thumb { background: var(--border); }
    
    .detail-section-title {
      font-size: 10px; font-weight: 700; color: var(--text-muted); margin-bottom: 10px;
      padding-bottom: 6px; border-bottom: 1px solid var(--border); text-transform: uppercase;
    }
    .detail-row { display: flex; justify-content: space-between; align-items: flex-start; padding: 4px 0; gap: 12px; }
    .dk { font-size: 10px; color: var(--text-dim); flex-shrink: 0; font-family: var(--font-mono); text-transform: uppercase; }
    .dv { font-size: 11px; color: var(--text); text-align: right; word-break: break-all; font-family: var(--font-mono); }
    .dv.blue { color: var(--cyan); }
    
    .url-full {
      font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); word-break: break-all; line-height: 1.6;
      background: var(--navy-3); padding: 10px; border-radius: var(--r);
      border: 1px solid var(--border); margin-top: 8px; cursor: pointer; transition: all .12s;
    }
    .url-full:hover { border-color: var(--cyan); color: var(--text); }

    .rule-card {
      background: var(--navy-3); border: 1px solid var(--border);
      border-radius: var(--r); padding: 12px; margin-top: 8px;
      position: relative;
    }
    .rule-card::before { content: ''; position: absolute; left: 0; top: 12px; bottom: 12px; width: 3px; background: var(--cyan); border-radius: 0 2px 2px 0; }
    .rule-id { font-size: 14px; font-weight: 800; color: var(--cyan); margin-bottom: 6px; font-family: var(--font-ui); }
    .rule-filter {
      font-family: var(--font-mono); font-size: 11px; color: var(--text); background: var(--navy);
      padding: 8px; border-radius: 4px; margin-top: 8px;
      border: 1px solid var(--border); word-break: break-all;
    }

    .action-btn {
      flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--border);
      background: var(--navy-3); color: var(--text-dim); font-family: var(--font-mono);
      font-size: 10px; font-weight: 500; cursor: pointer; text-align: center; transition: all .12s;
      text-transform: uppercase;
    }
    .action-btn:hover { border-color: var(--cyan); color: var(--cyan); background: var(--navy-4); }

    /* ─── TIMELINE VIEW ─── */
    .timeline-view { flex: 1; overflow-y: auto; padding: 16px; background: var(--navy); }
    .tl-row {
      display: flex; align-items: center; gap: 12px; padding: 6px 0;
      border-bottom: 1px solid var(--border); font-size: 11px;
    }
    .tl-status { width: 60px; font-size: 9px; font-weight: 800; flex-shrink: 0; text-transform: uppercase; font-family: var(--font-mono); }
    .tl-status.blocked { color: var(--red); }
    .tl-status.allowed { color: var(--green); }
    .tl-bar-wrap { flex: 1; height: 12px; background: var(--navy-2); border-radius: 2px; overflow: hidden; border: 1px solid var(--border); }
    .tl-bar-fill { height: 100%; border-radius: 2px; min-width: 2px; }
    .tl-bar-fill.ad { background: var(--red); }
    .tl-bar-fill.allowed { background: var(--green); opacity: 0.4; }

    /* ─── STATUS BAR ─── */
    .statusbar {
      display: flex; align-items: center; gap: 16px;
      padding: 6px 16px; background: var(--navy-2);
      border-top: 1px solid var(--border);
      font-size: 10px; color: var(--text-dim); flex-shrink: 0;
      font-family: var(--font-mono); text-transform: uppercase;
    }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--cyan); box-shadow: 0 0 6px var(--cyan); animation: breathe 2s ease infinite; }
    @keyframes breathe { 0%,100% { opacity:1; } 50% { opacity:.3; } }
  </style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <svg class="logo-icon" viewBox="0 0 24 24" fill="none">
    <path d="M12 2L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-3z" fill="#1a73e8" opacity=".15"/>
    <path d="M12 2L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-3z" stroke="#1a73e8" stroke-width="1.5" fill="none"/>
    <path d="M9 12l2 2 4-4" stroke="#1a73e8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  <span class="logo">Ad<em>Trace</em></span>
  <div class="topbar-sep"></div>
  <div class="stat-pill sp-blue"><div class="dot"></div><span class="num" id="tpBlocked">0</span> blocked</div>
  <div class="stat-pill sp-yellow"><div class="dot"></div><span class="num" id="tpTrackers">0</span> trackers</div>
  <div class="stat-pill sp-red"><div class="dot"></div><span class="num" id="tpAds">0</span> ads</div>
  <div class="stat-pill sp-purple"><div class="dot"></div><span class="num" id="tpSocial">0</span> social</div>
  <div class="stat-pill sp-green"><div class="dot"></div><span class="num" id="tpSavings">0ms</span> saved</div>
  <div class="stat-pill sp-orange" id="fpPill" style="display:none"><div class="dot"></div><span class="num" id="tpFP">0</span> warnings</div>
  <div class="spacer"></div>
  <button class="topbar-btn" id="btnInspect">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    Inspect
  </button>
  <button class="topbar-btn" id="btnDevOverlay">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
    Dev Overlay
  </button>
  <button class="topbar-btn" id="btnSimulate">Simulate User</button>
  <button class="topbar-btn" id="btnExport">Export</button>
  <button class="topbar-btn danger" id="btnClear">Clear</button>
</div>

<!-- FP Alert -->
<div class="fp-alert-bar" id="fpAlertBar">
  <svg viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>
  <span><strong id="fpAlertCount">0</strong> blocked requests may break page functionality</span>
  <button class="fp-dismiss" id="fpDismiss">&#x2715;</button>
</div>

<!-- View Tabs -->
<div class="view-tabs">
  <button class="view-tab active" data-view="log">Request Log</button>
  <button class="view-tab" data-view="timeline">Timeline</button>
  <button class="view-tab" data-view="graph">Tracker Graph</button>
</div>

<!-- Mini Timeline -->
<div class="timeline-bar" id="miniTimeline"><span class="tl-label">60s</span></div>

<!-- Sim Banner -->
<div class="sim-banner" id="simBanner">
  <div class="pulse"></div>Simulating user view — all ads visible
  <button class="sim-close-btn" id="simBannerClose">&#x2715;</button>
</div>

<!-- Filter Bar -->
<div class="filterbar">
  <span class="filter-label">Filter:</span>
  <div class="chip on" data-f="all">All</div>
  <div class="chip" data-f="ad">Ads</div>
  <div class="chip" data-f="tracker">Trackers</div>
  <div class="chip" data-f="social">Social</div>
  <div class="chip" data-f="other">Other</div>
  <div class="chip" data-f="fp">Warnings</div>
  <input class="search-input" id="searchInput" placeholder="Search URL, domain, or intent..." />
</div>

<!-- Main Content -->
<div class="main">
  <div class="view-panel active" id="view-log">
    <div style="display:flex; flex:1; overflow:hidden;">
      <div class="request-pane">
        <div class="table-head">
          <span></span><span>URL</span><span>Type</span><span>Rule</span><span>Intent</span><span>Category</span><span style="text-align:right">Time</span>
        </div>
        <div class="table-body" id="tableBody">
          <div class="detail-empty" style="height:200px">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-3z"/></svg>
            <div>Waiting for blocked requests...<br>Navigate to a page with ads.</div>
          </div>
        </div>
      </div>
      <div class="detail-pane">
        <div class="detail-header">Request Detail</div>
        <div class="detail-body" id="detailBody">
          <div class="detail-empty">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
            <div>Select a blocked request<br>to inspect it</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="view-panel" id="view-timeline">
    <div class="timeline-view" id="timelineView">
      <div class="detail-empty" style="height:200px">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-3z"/></svg>
        <div>Loading timeline data...</div>
      </div>
    </div>
  </div>
  <div class="view-panel" id="view-graph">
    <div class="graph-view" id="graphView"><canvas class="graph-canvas" id="graphCanvas"></canvas></div>
  </div>
</div>

<!-- Status Bar -->
<div class="statusbar">
  <div class="status-item"><div class="status-dot" id="statusDot"></div><span id="statusText">Blocking active</span></div>
  <div class="status-sep"></div>
  <div class="status-item" id="statusPage">Page: &#x2014;</div>
  <div class="status-sep"></div>
  <div class="status-item" id="statusRules">20 rules loaded</div>
  <div class="spacer"></div>
  <div class="status-item" id="statusLast">&#x2014;</div>
</div>

<script src="devpanel.js"></script>
</body>
</html>
