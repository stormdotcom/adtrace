<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AdTrace DevPanel</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Syne:wght@600;700;800&display=swap');

  :root {
    --navy:    #070c18;
    --navy-2:  #0b1221;
    --navy-3:  #0f192e;
    --navy-4:  #172237;
    --navy-5:  #1d2d48;
    --cyan:    #00d4ff;
    --cyan-d:  #00d4ff18;
    --cyan-m:  #00d4ff55;
    --amber:   #f59e0b;
    --amber-d: #f59e0b18;
    --red:     #ff4757;
    --red-d:   #ff475718;
    --green:   #2dce7d;
    --green-d: #2dce7d18;
    --purple:  #a78bfa;
    --purple-d:#a78bfa18;
    --text:    #dde4f0;
    --muted:   #4a6080;
    --dim:     #7a90b0;
    --border:  #182338;
    --mono:    'JetBrains Mono', 'Cascadia Code', monospace;
    --ui:      'Syne', system-ui, sans-serif;
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { height:100%; overflow:hidden; }

  body {
    background: var(--navy);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    display: flex;
    flex-direction: column;
  }

  /* ─── TOP BAR ─── */
  .topbar {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 12px;
    background: var(--navy-2);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    position: relative;
  }
  .topbar::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, var(--cyan), var(--purple) 50%, var(--amber));
  }
  .logo {
    font-family: var(--ui);
    font-size: 15px;
    font-weight: 800;
    letter-spacing: -.02em;
    color: var(--text);
    flex-shrink: 0;
  }
  .logo em { color: var(--cyan); font-style: normal; }

  .topbar-sep { width: 1px; height: 18px; background: var(--border); flex-shrink: 0; }

  .stat-pill {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 3px 8px;
    border-radius: 3px;
    background: var(--navy-3);
    border: 1px solid var(--border);
    font-size: 11px;
    white-space: nowrap;
  }
  .stat-pill .dot { width: 5px; height: 5px; border-radius: 50%; flex-shrink: 0; }
  .stat-pill .num { font-weight: 700; }
  .sp-cyan { color: var(--cyan); } .sp-cyan .dot { background: var(--cyan); }
  .sp-amber { color: var(--amber); } .sp-amber .dot { background: var(--amber); }
  .sp-red { color: var(--red); } .sp-red .dot { background: var(--red); }
  .sp-purple { color: var(--purple); } .sp-purple .dot { background: var(--purple); }

  .spacer { flex: 1; }

  .topbar-btn {
    padding: 4px 10px;
    border-radius: 3px;
    border: 1px solid var(--border);
    background: var(--navy-3);
    color: var(--dim);
    font-family: var(--mono);
    font-size: 10px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: .06em;
    transition: all .12s;
    white-space: nowrap;
  }
  .topbar-btn:hover { border-color: var(--dim); color: var(--text); }
  .topbar-btn.active { background: var(--cyan-d); border-color: var(--cyan); color: var(--cyan); }
  .topbar-btn.amber { }
  .topbar-btn.amber.active { background: var(--amber-d); border-color: var(--amber); color: var(--amber); }
  .topbar-btn.danger:hover { background: var(--red-d); border-color: var(--red); color: var(--red); }

  /* ─── FILTER BAR ─── */
  .filterbar {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    background: var(--navy-2);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
  }
  .filter-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: .07em; flex-shrink: 0; }
  .chip {
    padding: 2px 8px;
    border-radius: 2px;
    border: 1px solid transparent;
    background: var(--navy-4);
    color: var(--muted);
    font-size: 10px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: .05em;
    transition: all .1s;
  }
  .chip:hover { color: var(--dim); }
  .chip.on { border-color: var(--cyan); background: var(--cyan-d); color: var(--cyan); }
  .chip[data-f="ad"].on { border-color: var(--red); background: var(--red-d); color: var(--red); }
  .chip[data-f="tracker"].on { border-color: var(--amber); background: var(--amber-d); color: var(--amber); }
  .chip[data-f="social"].on { border-color: var(--purple); background: var(--purple-d); color: var(--purple); }

  .search-input {
    flex: 1;
    background: var(--navy-3);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 3px 8px;
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text);
    outline: none;
    transition: border-color .15s;
  }
  .search-input:focus { border-color: var(--cyan-m); }
  .search-input::placeholder { color: var(--muted); }

  /* ─── MAIN LAYOUT ─── */
  .main { display: flex; flex: 1; overflow: hidden; }

  /* ─── REQUEST TABLE ─── */
  .request-pane {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-right: 1px solid var(--border);
  }
  .table-head {
    display: grid;
    grid-template-columns: 20px 1fr 80px 70px 80px 90px;
    padding: 4px 10px;
    background: var(--navy-3);
    border-bottom: 1px solid var(--border);
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: .06em;
    flex-shrink: 0;
  }
  .table-head span { cursor: pointer; user-select: none; }
  .table-head span:hover { color: var(--dim); }

  .table-body {
    flex: 1;
    overflow-y: auto;
  }
  .table-body::-webkit-scrollbar { width: 5px; }
  .table-body::-webkit-scrollbar-track { background: var(--navy); }
  .table-body::-webkit-scrollbar-thumb { background: var(--navy-5); border-radius: 2px; }

  .row {
    display: grid;
    grid-template-columns: 20px 1fr 80px 70px 80px 90px;
    padding: 4px 10px;
    border-bottom: 1px solid #0a101c;
    cursor: pointer;
    transition: background .08s;
    animation: rowIn .12s ease-out;
  }
  @keyframes rowIn { from { opacity:0; background: var(--cyan-d); } to { opacity:1; } }
  .row:hover { background: var(--navy-3); }
  .row.selected { background: var(--navy-4); border-left: 2px solid var(--cyan); }
  .row.flash { animation: flash .4s ease-out; }
  @keyframes flash { 0% { background: var(--cyan-d); } 100% { background: transparent; } }

  .row .cat-dot { display: flex; align-items: center; justify-content: center; }
  .dot { width: 6px; height: 6px; border-radius: 50%; }
  .dot.ad { background: var(--red); box-shadow: 0 0 4px var(--red); }
  .dot.tracker { background: var(--amber); box-shadow: 0 0 4px var(--amber); }
  .dot.social { background: var(--purple); box-shadow: 0 0 4px var(--purple); }
  .dot.other { background: var(--muted); }

  .row .url-col {
    font-size: 11px;
    color: var(--dim);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding-right: 8px;
  }
  .row .url-col .domain-part { color: var(--text); font-weight: 500; }
  .row .type-col { font-size: 10px; color: var(--muted); }
  .row .rule-col { font-size: 10px; color: var(--cyan-m); }
  .row .cat-col { font-size: 10px; text-transform: uppercase; letter-spacing: .04em; }
  .cat-col.ad { color: var(--red); }
  .cat-col.tracker { color: var(--amber); }
  .cat-col.social { color: var(--purple); }
  .cat-col.other { color: var(--muted); }
  .row .time-col { font-size: 10px; color: var(--muted); text-align: right; }

  /* ─── DETAIL PANE ─── */
  .detail-pane {
    width: 320px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--navy-2);
  }
  .detail-header {
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: .07em;
    flex-shrink: 0;
  }
  .detail-body { flex: 1; overflow-y: auto; padding: 10px 12px; }
  .detail-body::-webkit-scrollbar { width: 4px; }
  .detail-body::-webkit-scrollbar-track { background: var(--navy-2); }
  .detail-body::-webkit-scrollbar-thumb { background: var(--navy-5); border-radius: 2px; }

  .detail-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--muted);
    gap: 8px;
    text-align: center;
    font-size: 11px;
    line-height: 1.6;
  }
  .detail-empty .icon { font-size: 28px; opacity: .4; }

  .detail-section { margin-bottom: 14px; }
  .detail-section-title {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: .09em;
    color: var(--muted);
    margin-bottom: 6px;
    padding-bottom: 4px;
    border-bottom: 1px solid var(--border);
  }
  .detail-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 3px 0;
    gap: 8px;
  }
  .dk { font-size: 10px; color: var(--muted); flex-shrink: 0; }
  .dv { font-size: 10px; color: var(--text); text-align: right; word-break: break-all; }
  .dv.cyan { color: var(--cyan); }
  .dv.amber { color: var(--amber); }
  .dv.red { color: var(--red); }
  .dv.green { color: var(--green); }

  .url-full {
    font-size: 10px;
    color: var(--dim);
    word-break: break-all;
    line-height: 1.5;
    background: var(--navy-3);
    padding: 6px 8px;
    border-radius: 3px;
    border: 1px solid var(--border);
    margin-top: 4px;
    cursor: pointer;
    transition: border-color .12s;
  }
  .url-full:hover { border-color: var(--cyan-m); }
  .url-full .url-domain { color: var(--cyan); font-weight: 600; }

  .rule-card {
    background: var(--navy-3);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 8px;
    margin-top: 4px;
  }
  .rule-id { font-size: 13px; font-weight: 700; color: var(--cyan); margin-bottom: 4px; }
  .rule-desc { font-size: 10px; color: var(--dim); line-height: 1.5; }
  .rule-filter { 
    font-size: 10px; color: var(--text); 
    background: var(--navy-4); padding: 4px 6px; 
    border-radius: 2px; margin-top: 6px;
    border-left: 2px solid var(--cyan);
  }

  .action-row {
    display: flex;
    gap: 6px;
    margin-top: 10px;
  }
  .action-btn {
    flex: 1;
    padding: 6px;
    border-radius: 3px;
    border: 1px solid var(--border);
    background: var(--navy-3);
    color: var(--dim);
    font-family: var(--mono);
    font-size: 10px;
    cursor: pointer;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: .06em;
    transition: all .12s;
  }
  .action-btn.allow { }
  .action-btn.allow:hover { background: var(--green-d); border-color: var(--green); color: var(--green); }
  .action-btn.block:hover { background: var(--red-d); border-color: var(--red); color: var(--red); }
  .action-btn.highlight:hover { background: var(--amber-d); border-color: var(--amber); color: var(--amber); }

  /* ─── BOTTOM STATUS ─── */
  .statusbar {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 4px 12px;
    background: var(--navy-2);
    border-top: 1px solid var(--border);
    font-size: 10px;
    color: var(--muted);
    flex-shrink: 0;
  }
  .status-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--green);
    box-shadow: 0 0 5px var(--green);
    animation: breathe 2s ease infinite;
  }
  .status-dot.paused { background: var(--muted); box-shadow: none; animation: none; }
  @keyframes breathe { 0%,100% { opacity:1; } 50% { opacity:.4; } }

  .status-item { display: flex; align-items: center; gap: 4px; }
  .status-sep { width: 1px; height: 10px; background: var(--border); }

  /* ─── TIMELINE MINI ─── */
  .timeline-bar {
    display: flex;
    align-items: flex-end;
    gap: 1px;
    height: 30px;
    padding: 2px 12px;
    background: var(--navy-2);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    overflow: hidden;
  }
  .tl-bar {
    flex: 1;
    min-width: 3px;
    max-width: 8px;
    border-radius: 1px 1px 0 0;
    transition: height .2s;
    opacity: .6;
  }
  .tl-bar.ad { background: var(--red); }
  .tl-bar.tracker { background: var(--amber); }
  .tl-bar.social { background: var(--purple); }
  .tl-bar.other { background: var(--muted); }
  .tl-label { font-size: 9px; color: var(--muted); flex-shrink: 0; }

  /* Simulate mode banner */
  .sim-banner {
    display: none;
    align-items: center;
    gap: 8px;
    padding: 5px 12px;
    background: var(--amber-d);
    border-bottom: 1px solid var(--amber);
    font-size: 10px;
    color: var(--amber);
    flex-shrink: 0;
  }
  .sim-banner.show { display: flex; }
  .sim-banner .pulse { width: 6px; height: 6px; border-radius: 50%; background: var(--amber); animation: breathe 1s ease infinite; }
  .sim-close-btn { margin-left: auto; background: none; border: none; color: var(--amber); cursor: pointer; font-size: 13px; line-height: 1; }
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <span class="logo">Ad<em>Trace</em></span>
  <div class="topbar-sep"></div>
  <div class="stat-pill sp-cyan"><div class="dot"></div><span class="num" id="tpBlocked">0</span> blocked</div>
  <div class="stat-pill sp-amber"><div class="dot"></div><span class="num" id="tpTrackers">0</span> trackers</div>
  <div class="stat-pill sp-red"><div class="dot"></div><span class="num" id="tpAds">0</span> ads</div>
  <div class="stat-pill sp-purple"><div class="dot"></div><span class="num" id="tpSocial">0</span> social</div>
  <div class="spacer"></div>
  <button class="topbar-btn amber" id="btnDevOverlay">Dev Overlay</button>
  <button class="topbar-btn amber" id="btnSimulate">Simulate User</button>
  <button class="topbar-btn" id="btnExport">Export JSON</button>
  <button class="topbar-btn danger" id="btnClear">Clear</button>
</div>

<!-- Timeline -->
<div class="timeline-bar" id="timeline">
  <span class="tl-label">Timeline →</span>
</div>

<!-- Simulate Banner -->
<div class="sim-banner" id="simBanner">
  <div class="pulse"></div>
  SIMULATING USER VIEW — All ads are now visible on page
  <button class="sim-close-btn" id="simBannerClose">✕</button>
</div>

<!-- Filter Bar -->
<div class="filterbar">
  <span class="filter-label">Filter:</span>
  <div class="chip on" data-f="all">All</div>
  <div class="chip" data-f="ad">Ads</div>
  <div class="chip" data-f="tracker">Trackers</div>
  <div class="chip" data-f="social">Social</div>
  <div class="chip" data-f="other">Other</div>
  <input class="search-input" id="searchInput" placeholder="Search URL or domain…" />
</div>

<!-- Main -->
<div class="main">
  <!-- Request Table -->
  <div class="request-pane">
    <div class="table-head">
      <span></span>
      <span>URL</span>
      <span>Type</span>
      <span>Rule</span>
      <span>Category</span>
      <span style="text-align:right">Time</span>
    </div>
    <div class="table-body" id="tableBody">
      <div class="detail-empty" style="height:200px">
        <div class="icon">⬡</div>
        <div>Waiting for blocked requests…<br>Navigate to a page with ads.</div>
      </div>
    </div>
  </div>

  <!-- Detail Pane -->
  <div class="detail-pane">
    <div class="detail-header">Request Detail</div>
    <div class="detail-body" id="detailBody">
      <div class="detail-empty">
        <div class="icon">←</div>
        <div>Select a blocked request<br>to inspect it</div>
      </div>
    </div>
  </div>
</div>

<!-- Status Bar -->
<div class="statusbar">
  <div class="status-item">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">Blocking active</span>
  </div>
  <div class="status-sep"></div>
  <div class="status-item" id="statusPage">Page: —</div>
  <div class="status-sep"></div>
  <div class="status-item" id="statusRules">20 rules loaded</div>
  <div class="spacer"></div>
  <div class="status-item" id="statusLast">—</div>
</div>

<script src="devpanel.js"></script>
</body>
</html>
